CREATE DATABASE QLSTK
GO
USE QLSTK
GO

CREATE TABLE LOAITIETKIEM
(
	MaLoaiTietKiem VARCHAR(20) NOT NULL PRIMARY KEY,
	TenLoaiTietKiem NVARCHAR(50) NOT NULL,
	KyHan INT NOT NULL,
	LaiSuat FLOAT NOT NULL CHECK(LaiSuat>=0),
	ThoiGianGuiToiThieu INT NOT NULL CHECK(ThoiGianGuiToiThieu>=0),
	--Doi ten tu SoTienDuocRut va sua thanh Nvarchar de hien thi bang loai tiet kiem
	QuyDinhSoTienRut NVARCHAR(50) NOT NULL,
	---Them DangSuDung de xoa 1 loai tiet kiem, thuc ra la chuyen no ve khong su dung nua de khong bi loi du lieu ay
	DangSuDung NVARCHAR(10) NOT NULL,
)
GO

CREATE TABLE SOTIETKIEM
(
	MaSoTietKiem VARCHAR(20) NOT NULL PRIMARY KEY,
	MaLoaiTietKiem VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES LOAITIETKIEM(MaLoaiTietKiem),
	TenKhachHang NVARCHAR(50) NOT NULL,
	DiaChi NVARCHAR(MAX) NOT NULL, 
	SoTienGuiBanDau MONEY NOT NULL CHECK(SoTienGuiBanDau>0),
	SoCMND VARCHAR(20) NOT NULL,
	NgayMoSo SMALLDATETIME NOT NULL,
	LaiSuatApDung FLOAT NOT NULL CHECK (LaiSuatApDung>=0), 
	NgayDaoHanKeTiep SMALLDATETIME NOT NULL,
	SoDu MONEY NOT NULL CHECK (SoDu>=0), 
	NgayDongSo SMALLDATETIME,
)
GO
ALTER TABLE SOTIETKIEM ADD CHECK(DATEDIFF(DAYOFYEAR,NgayMoSo,NgayDongSo)>0)
GO

CREATE TABLE PHIEUGUI
(
	MaPhieuGui VARCHAR(20) NOT NULL PRIMARY KEY,
	MaSoTietKiem VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES SOTIETKIEM(MaSoTietKiem),
	NgayGui SMALLDATETIME NOT NULL,
	SoTienGui MONEY NOT NULL CHECK (SoTienGui>0)
)
GO

CREATE TABLE PHIEURUT
(
	MaPhieuRut VARCHAR(20) NOT NULL PRIMARY KEY,
	MaSoTietKiem VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES SOTIETKIEM(MaSoTietKiem),
	NgayRut SMALLDATETIME NOT NULL,
	SoTienRut MONEY NOT NULL CHECK (SoTienRut>0)
)
GO

CREATE TABLE BAOCAODOANHSO
(
	MaBaoCaoDoanhSo VARCHAR(20) NOT NULL PRIMARY KEY,
	NgayDoanhSo SMALLDATETIME NOT NULL,
	MaLoaiTietKiem VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES LOAITIETKIEM(MaLoaiTietKiem),
	TongThu MONEY NOT NULL CHECK (TongThu>=0),
	TongChi MONEY NOT NULL CHECK (TongChi>=0),
	ChenhLech MONEY NOT NULL,
)
GO

CREATE TABLE BAOCAOMODONG
(
	MaBaoCaoMoDong VARCHAR(20) NOT NULL PRIMARY KEY,
	MaLoaiTietKiem VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES LOAITIETKIEM(MaLoaiTietKiem),
	ThangBaoCao INT NOT NULL CHECK (ThangBaoCao>=1 AND ThangBaoCao<=12),
	NamBaoCao INT NOT NULL CHECK (NamBaoCao>0),
)
GO

CREATE TABLE CTBCMODONG
(
	MaBaoCaoMoDong VARCHAR(20) NOT NULL FOREIGN KEY REFERENCES BAOCAOMODONG(MaBaoCaoMoDong),
	NgayXet SMALLDATETIME NOT NULL,
	-----Sua lai rang buoc nho hon bang
	SoLuongSoMo INT NOT NULL CHECK (SoLuongSoMo>=0),
	SoLuongSoDong INT NOT NULL CHECK (SoLuongSoDong>=0),
	ChenhLech INT NOT NULL,
	---sua lai khoa chinh la hai thuoc tinh nay
	PRIMARY KEY (MaBaoCaoMoDong,NgayXet)
)
GO

CREATE TABLE THAMSO
(
	MaThamSo INT NOT NULL PRIMARY KEY,
	TenThamSo NVARCHAR(50) NOT NULL,
	GiaTri MONEY NOT NULL
)
GO

----QUAN LI NGUOI DUNG

CREATE TABLE CHUCNANG
(
	MaChucNang INT NOT NULL PRIMARY KEY,
	TenChucNang NVARCHAR(50) NOT NULL,
	TenThanhPhanSuDung NVARCHAR(50) NOT NULL
)
GO

CREATE TABLE NHOMNGUOIDUNG
(
	MaNhom INT NOT NULL PRIMARY KEY,
	TenNhom NVARCHAR(50) NOT NULL
)
GO

CREATE TABLE PHANQUYEN
(
	MaNhom INT NOT NULL FOREIGN KEY REFERENCES NHOMNGUOIDUNG(MaNhom),
	MaChucNang INT NOT NULL FOREIGN KEY REFERENCES CHUCNANG(MaChucNang),
	LiDo NVARCHAR(50),
	PRIMARY KEY(MaNhom,MaChucNang)
)
GO

CREATE TABLE NGUOIDUNG
(
	TenDangNhap VARCHAR(50) NOT NULL PRIMARY KEY,
	MatKhau VARCHAR(50) NOT NULL,
	MaNhom INT NOT NULL FOREIGN KEY REFERENCES NHOMNGUOIDUNG(MaNhom),
	HoTen NVARCHAR(50)
)
GO

INSERT INTO LOAITIETKIEM VALUES('LTK001',N'Không kì hạn',0,0.5,15,N'Rút nhỏ hơn hoặc bằng',N'Có')
INSERT INTO LOAITIETKIEM VALUES('LTK002',N'3 tháng',90,5,90,N'Rút hết',N'Có')
INSERT INTO LOAITIETKIEM VALUES('LTK003',N'6 tháng',180,5.5,180,N'Rút hết',N'Có')

INSERT INTO THAMSO VALUES(1,N'Số tiền gửi tối thiểu',1000000)
INSERT INTO THAMSO VALUES(2,N'Tiền gửi thêm tối thiểu',100000)
INSERT INTO THAMSO VALUES(3,N'Đóng sổ tự động',1)

INSERT INTO CHUCNANG VALUES(1,N'Quản lý nhân sự',N'QuanLyNhanSu_Page_Button')
INSERT INTO CHUCNANG VALUES(2,N'Mở sổ tiết kiệm',N'MoSo_Page_Button')
INSERT INTO CHUCNANG VALUES(3,N'Lập phiếu gửi',N'GuiTien_Page_Button')
INSERT INTO CHUCNANG VALUES(4,N'Lập phiếu rút',N'RutTien_Page_Button')
INSERT INTO CHUCNANG VALUES(5,N'Tra cứu sổ',N'TraCuu_Page_Button')
INSERT INTO CHUCNANG VALUES(6,N'Lập báo cáo doanh số',N'BaoCaoDoanhSo_Page_Button')
INSERT INTO CHUCNANG VALUES(7,N'Lập báo cáo mở đóng',N'BaoCaoMoDong_Page_Button')
INSERT INTO CHUCNANG VALUES(8,N'Thay đổi quy định',N'ThayDoiQuyDinh_Page_Button')
INSERT INTO CHUCNANG VALUES(9,N'Nhập lãi vào vốn cho sổ quá hạn cuối ngày',N'NhapLaiVaoVon_KTV_Button')

INSERT INTO NHOMNGUOIDUNG VALUES(1,N'Quản Trị Viên')
INSERT INTO NHOMNGUOIDUNG VALUES(2,N'Kiểm Toán Viên')
INSERT INTO NHOMNGUOIDUNG VALUES(3,N'Giao Dịch Viên')
INSERT INTO NHOMNGUOIDUNG VALUES(4,N'Trưởng Phòng Nhân Sự')

INSERT INTO PHANQUYEN VALUES(1,1,N'QTV_QuanLyNhanSu')
INSERT INTO PHANQUYEN VALUES(1,2,N'QTV_MoSo')
INSERT INTO PHANQUYEN VALUES(1,3,N'QTV_GuiTien')
INSERT INTO PHANQUYEN VALUES(1,4,N'QTV_RutTien')
INSERT INTO PHANQUYEN VALUES(1,5,N'QTV_TraCuu')
INSERT INTO PHANQUYEN VALUES(1,6,N'QTV_BaoCaoDoanhSo')
INSERT INTO PHANQUYEN VALUES(1,7,N'QTV_BaoCaoMoDong')
INSERT INTO PHANQUYEN VALUES(1,8,N'QTV_ThayDoiQuyDinh')
INSERT INTO PHANQUYEN VALUES(1,9,N'QTV_NhapLaiVaoVon')
INSERT INTO PHANQUYEN VALUES(2,5,N'KTV_TraCuu')
INSERT INTO PHANQUYEN VALUES(2,6,N'KTV_BaoCaoDoanhSo')
INSERT INTO PHANQUYEN VALUES(2,7,N'KTV_BaoCaoMoDong')
INSERT INTO PHANQUYEN VALUES(2,8,N'KTV_NhapLaiVaoVon')
INSERT INTO PHANQUYEN VALUES(3,2,N'GDV_MoSo')
INSERT INTO PHANQUYEN VALUES(3,3,N'GDV_GuiTien')
INSERT INTO PHANQUYEN VALUES(3,4,N'GDV_RutTien')
INSERT INTO PHANQUYEN VALUES(3,5,N'GDV_TraCuu')
INSERT INTO PHANQUYEN VALUES(4,1,N'NS_QuanLyNhanSu')

INSERT INTO NGUOIDUNG VALUES('admin','admin',1,N'Sơn')
INSERT INTO NGUOIDUNG VALUES('ktv1','ktv1',2,N'Sanh')
INSERT INTO NGUOIDUNG VALUES('ktv2','ktv2',2,N'Tiến')
INSERT INTO NGUOIDUNG VALUES('gdv1','gdv1',3,N'Trung')
INSERT INTO NGUOIDUNG VALUES('gdv2','gdv2',3,N'Thắng')
INSERT INTO NGUOIDUNG VALUES('ns1','ns1',4,N'Châu')

INSERT INTO SOTIETKIEM VALUES('STK0000001','LTK002',N'Lê Sơn',N'Biên Hòa - Đồng Nai',4500000,'123456789','6/2/2020',5,'8/31/2020',4500000,null)
INSERT INTO SOTIETKIEM VALUES('STK0000002','LTK003',N'Phạm Sanh',N'Tuy Hòa, Phú Yên',123456000,'152346369','6/2/2020',5.5,'11/29/2020',123456000,null)
INSERT INTO SOTIETKIEM VALUES('STK0000003','LTK001',N'Phan Tiến',N'TP HCM',2300000,'15234634649','4/1/2020',0.5,'4/1/2020',2300000,null)


